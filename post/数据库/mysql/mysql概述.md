## 1.1 MySQL是什么？

随着时间的推移，开源数据库在中低端应用中逐渐流行起来，占据了很大的市场份额。开源数据库具有免费使用、配置简单、稳定性好、性能优良等特点，而 `MySQL` 数据库正是开源数据库中的杰出代表。


开源全称为“开放源代码”。很多人认为开源软件最明显的特点是免费，但实际上并不是这样的，开源软件最大的特点应该是开放，也就是任何人都可以得到软件的源代码。可以在源代码的基础上加以修改学习，甚至重新发放，当然是在版权限制范围之内。不清楚的读者可以参考《开源就等于免费吗？用事实来说话》一节。

`MySQL` 是最流行的数据库之一，是一个免费开源的关系型数据库管理系统，但也不意味着该数据库是完全免费的。`MySQL` 由瑞典 **MySQL AB** 公司开发，目前属于 **Oracle** 公司。`MySQL` 适合中小型软件，被个人用户以及中小企业青睐。

针对不同的用户，`MySQL` 分为两个版本：
**MySQL Community Server（社区版）：**该版本是自由下载且完全免费的，但是官方不提供技术支持。
**MySQL Enterprise Server（企业版）：**该版本是收费的，而且不能下载，但是该版本拥有完善的技术支持（官方提供电话技术支持）。

**注意：MySQL Cluster 主要用于架设群服务器，需要在社区服务或企业版的基础上使用。**

`MySQL` 的命名机制由 3 个数字和 1 个后缀组成，例如 **mysql-5.7.20：**

- 第 1 个数字“5”是主版本号，用于描述文件的格式，所有版本 5 的发行版都有相同的文件夹格式。
- 第 2 个数字“7”是发行级别，主版本号和发行级别组合在一起便构成了发行序列号。
- 第 3 个数字“20”是在此发行系列的版本号，随每次新发行的版本递增。通常选择已经发行的最新版本。

在 `MySQL` 开发过程中，同时存在多个发布系列，每个发布系列的成熟度处在不同阶段。

- **MySQL 5.7** 是最新开发的稳定（GA）发布系列，是将执行新功能的系列，目前已经可以正常使用。
- **MySQL 5.6** 是比较稳定的（GA）发布系列，只针对漏洞修复重新发布，不增加会影响稳定性的新功能。
- **MySQL 5.1** 是一个稳定的（产品质量）发布系列，只针对严重漏洞修复和安全修复重新发布，不增加影响该系列稳定性的重要功能。


**注意：对于 MySQL 4.1 等低于 5.0 的老版本，官方将不再提供支持。所有发布的 MySQL 版本已经经过严格标准的测试，可以保证其安全可靠地使用。针对不同的操作系统，读者可以在MySQL官方下载页面[下载](http://dev.mysql.com/downloads/)相应的安装文件。**

## 1.2. MySQL的特点、优势

`MySQL` 数据库管理系统具有很多的优势，下面总结了其中几种。

#### 1）MySQL 是开放源代码的数据库

`MySQL` 是开放源代码的数据库，任何人都可以获取该数据库的源代码。这就使得任何人都可以修正 `MySQL` 的缺陷，并且任何人都能以任何目的来使用该数据库。`MySQL` 是一款可以自由使用的数据库。

#### 2）MySQL 的跨平台性

`MySQL` 不仅可以在 **Windows 系列**的操作系统上运行，还可以在 **UNIX**、**Linux** 和 **Mac OS** 等操作系统上运行。因为很多网站都选择 **UNIX**、**Linux** 作为网站的服务器，所以 `MySQL` 的跨平台性保证了其在 **Web 应用**方面的优势。虽然微软公司的 **SQL Server 数据库**是一款很优秀的商业数据库，但是其只能在 **Windows 系列**的操作系统上运行。因此，`MySQL` 数据库的跨平台性是一个很大的优势。

#### 3）价格优势

`MySQL` 数据库是一个自由软件，任何人都可以从 `MySQL` 的官方网站上下载该软件，这些社区版本的 MySQL 都是免费试用的，即使是需要付费的附加功能，其价格也是很便宜的。相对于 `Oracle`、`DB2` 和 `SQL Server` 这些价格昂贵的商业软件，`MySQL` 具有绝对的价格优势。

#### 4）功能强大且使用方便

`MySQL` 是一个真正的多用户、 多线程 `SQL` 数据库服务器。它能够快速、有效和安全的处理大量的数据。相对于 `Oracle` 等数据库来说，`MySQL` 的使用是非常简单的。`MySQL` 主要目标是快速、健壮和易用。


`MySQL` 与常用的主流数据库 `Oracle`、`SQL` `Server` 相比，主要特点就是免费，并且在任何平台上都能使用，占用的空间相对较小。但是，`MySQL` 也有一些不足，比如对于大型项目来说，`MySQL` 的容量和安全性就略逊于 `Oracle` 数据库。

## 1.3. MySQL适用于哪些场景？

`MySQL` 是目前世界上最流行的开源关系数据库，大多应用于互联网行业。比如，在国内，大家所熟知的百度、腾讯、淘宝、京东、网易、新浪等，国外的 **Google**、**Facebook**、**Twitter**、**GitHub** 等都在使用 `MySQL`。社交、电商、游戏的核心存储往往也是 `MySQL`。


任何产品都不可能是万能的，也不可能适用于所有的应用场景。那么 MySQL 到底适用于哪些场景又不适用于哪些场景呢？

#### 1. Web 网站系统

**Web 网站开发者**是 `MySQL` 最大的客户群，也是 `MySQL` 发展史上最为重要的支撑力量。

`MySQL` 之所以能成为 **Web 网站开发者**们最青睐的数据库管理系统，是因为 `MySQL` 数据库的安装配置都非常简单，使用过程中的维护也不像很多大型商业数据库管理系统那么复杂，而且性能出色。还有一个非常重要的原因就是 `MySQL` 是开放源代码的，完全可以免费使用。

#### 2、日志记录系统

`MySQL` 数据库的插入和查询性能都非常的高效，如果设计的好，在使用 **MyISAM 存储引擎**的时候，两者可以做到互不锁定，达到很高的并发性能。所以，对需要大量的插入和查询日志记录的系统来说，`MySQL` 是非常不错的选择。比如处理用户的登录日志，操作日志等，都是非常适合的应用场景。

#### 3、数据仓库系统

随着现在数据仓库数据量的飞速增长，我们需要的存储空间越来越大。数据量的不断增长，使数据的统计分析变得越来越低效，也越来越困难。下面是几个主要的解决思路。

- 1）采用昂贵的高性能主机以提高计算性能，用高端存储设备提高 **I/O** 性能，效果理想，但是成本非常高；

- 2）通过将数据复制到多台使用大容量硬盘的廉价 **PC Server** 上，以提高整体计算性能和 **I/O** 能力，效果尚可，存储空间有一定限制，成本低廉；

- 3）通过将数据水平拆分，使用多台廉价的 **PC Server** 和本地磁盘来存放数据，每台机器上面都只有所有数据的一部分，解决了数据量的问题，所有 **PC Server** 一起并行计算，也解决了计算能力问题，通过中间代理程序调配各台机器的运算任务，既可以解决计算性能问题又可以解决 **I/O** 性能问题，成本也很低廉。

在上面的三个方案中，第二和第三个的实现，`MySQL` 都有较大的优势。通过 `MySQL` 的简单复制功能，可以很好的将数据从一台主机复制到另外一台 ，不仅仅在局域网内可以复制，在广域网同样可以。


当然，很多人可能会说，其他的数据库同样也可以做到，不是只有 `MySQL` 有这样的功能。确实，很多数据库同样能做到，但是 `MySQL` 是免费的，其他数据库大多都是按照主机数量或者 **cpu** 数量来收费，当我们使用大量的 **PC Server** 的时候，**License** 费用相当惊人。所以第一个方案，基本上所有数据库系统都能够实现，但是其高昂的成本不是每一个公司都能够承担的。

#### 4、嵌入式系统

嵌入式环境对软件系统最大的限制是硬件资源非常有限，在嵌入式环境下运行的软件系统，必须是轻量级低消耗的软件。

`MySQL` 在资源的使用方面的伸缩性非常大，可以在资源非常充裕的环境下运行，也可以在资源非常少的环境下正常运行。它对于嵌入式环境来说，是一种非常合适的数据库系统，而且 `MySQL` 有专门针对于嵌入式环境的版本。

并且，`MySQL` 的定位是通用数据库，各种类型的应用一般都能利用到 `MySQL` 存取数据的优势。业内生产实践证明，`MySQL` 更适合中小型企业。以目前的软硬件产品水平来看，如果数据超过几个 **TB** 将难以高效利用 `MySQL`。

`MySQL` 可以作为传统的关系型数据库产品使用，也可以当作一个 **key-value 产品**来使用。由于它具有优秀的灾难恢复功能，因此相对于目前市场上的一些 **key-value 产品**会更有优势。

## 1.4. 数据库中的专业术语

在正式学习 `MySQL` 数据库前，我们有必要先了解一下数据库中的专业术语。下面汇总了一些在学习 MySQL 过程中会遇到的专业术语。

**数据库管理系统（DBMS）**是位于操作系统与用户之间的一种操纵和管理数据库的软件。关系型数据库通过关系数据库管理系统（RDBMS）进行管理。

**关系（Relational，即 RDBMS 里的 R）**表示这是一种特殊的 **DBMS**，数据库中表与表之间要存在关系。

**数据库（DataBase，即 RDBMS 里的 DB）**是一个用来存储和管理数据的仓库。它的存储空间很大，并且有一定的数据存放规则。通过由行和列组成的**二维表（类似 Excel 工作表）**来管理数据。数据库中可以同时存储多个表。

**管理系统（Management System，即 RDBMS 里的 MS）**是一个软件，我们可以通过它来`插入（insert）`、`查询（query）`、`修改（modify）`或 `删除（delete）`表中的数据。

用来管理数据的二维表在关系数据库中简称为`表（Table）`，每个表由多个`行（Row）`和`列（Column）`组成。

表的**列（垂直方向）**称为`字段`，是具有相同数据类型的数据集合。表的**行（水平方向）**称为`记录（Record）`，相当于一条数据。记录可以包含多项信息，表中的每一列都对应于其中的某一项。

下图是一个统计学生信息的 **student 表**。可以看到，每个列都包含了所有学生的某个信息，比如 **name（姓名）**。而每行则包含了某个学生的所有信息，即 **id（编号）**、**name（姓名）**、**age（年龄）**、**stuno（学号）**等。

![](https://cdn.jsdelivr.net/gh/shuxhan/pic-cdn@3485ee1d38a524736e5e7e1bb8e98666d1ec80fc/2021/04/25/34f881f3028ce076eac82ddce0271ba2.png)

**SQL（Structured Query Language，结构化查询语言）**是用来操作关系型数据库的语言，使用 `SQL` 可以对数据库和表进行添加、删除、修改和查询等操作。

与其它计算机语言一样，初次接触 `SQL` 的人肯定会觉得它很奇怪。例如，在创建表时，很多人都会把表与图表或图片联系起来，但是 `MySQL` 不是这样的。在 `MySQL` 中创建表时，你必须输入类似下面这样的内容。

```sql
CREATE TABLE `student` (
  `id` int(4),
  `name` varchar(20),
  `age` int(4),
  `stuno` int(11),
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
```

如果你对 `SQL` 还不太熟悉，可能会对以上语句心生畏惧。不过请放心，随着教程的深入学习，你会很快的熟练使用 `SQL`，并且对上述 `SQL` 语句的看法也会悄然地发生变化。它不再是一组怪诞地表达，而是一种有助于信息描述的强大工具。

## 1.5. MySQL客户端和服务器架构（C/S架构）

**客户端-服务器（Client/Server）结构**简称 **C/S 结构**，是一种**网络架构**，通常在该网络架构下的软件分为**客户端**和**服务器**。

**服务器**是整个应用系统资源的**存储**和**管理中心**，多个客户端分别各自处理相应的功能，共同实现完整的应用。在**客户/服务器结构**中，客户端用户的请求被传送到数据库服务器，数据库服务器进行处理后，将结果返回给用户，从而减少网络数据的传输量。

用户在使用应用程序时，首先启动客户端，然后通过相关命令告知服务器进行连接以完成各种操作，而服务器则按照此请示提供相应的服务。每一个客户端软件的实例都可以向一个服务器或应用程序服务器发出请求。

**客户端**和**服务器**程序通常不在同一台计算机上运行，比如，我们平时在当当网上买书的时候，所使用的电脑和网页浏览器就被当做了一个客户端，同时，组成当当网的电脑、数据库和应用程序就被当做服务器。

**数据库管理系统**可分为两类：

- 一类是基于**共享文件系统的数据库管理系统**，例如 `Microsoft Access` 和 `FileMaker`，主要用于桌面用途，不适合用于高端或更关键的应用；

- 另一类是**基于客户端-服务器的数据库管理系统**，例如 `MySQL`、`Oracle` 和 `SQL Server` 等数据库。

服务器软件负责访问和处理所有数据的一个软件，这个软件运行在称为**数据库服务器**的计算机上，并且与数据文件打交道的只有服务器软件。

关于数据的**添加**、**删除**和**更新**等所有的请求都由服务器完成。这些请求来自于运行客户端的计算机。客户端用来和用户打交道。例如，如果你请求一个按字母顺序列出的产品表，则客户端会通过网络提交该请求给服务器，服务器处理这个请求，然后根据需要对数据进行过滤、丢弃和排序，最后把结果返回到客户端。

**注意：客户端和服务器可以安装在两台计算机或一台计算机上，不管它们在不在相同的计算机上，客户端都要与服务器进行通信。**

以上这些过程对用户都是透明的，你不需要直接访问数据文件。为了使用`MySQL`，你需要访问运行 `MySQL` 服务器的计算机和发布命令到 `MySQL 客户端`的计算机。

对于 **MySQL 数据库管理系统**，服务器为`MySQL DBMS`。你可以在本地安装的副本上运行，也可以连接到运行在你具有访问权的远程服务器上的一个副本。

**客户端**可以是 `MySQL` 提供的**工具**（如 `MySQL Workbench`、`SQLyog`）、**脚本语言**（如`Perl`）、**Web 应用开发语言**（如`ASP`、`ColdFusion`、`JSP` 和 `PHP`）和**程序设计语言**（如 `C`、`C++`、`Java`）等。

## 1.6. MySQL内部结构

麻雀虽小，五脏俱全。`MySQL` 虽然以简单著称，但其内部结构并不简单，本节主要介绍 `MySQL` 的整体架构组成。

学习 `MySQL` 就好比盖房子，如果想把房子盖的特别高，地基一定要稳，基础一定要牢固。学习 `MySQL` 数据库前要先了解它的内部结构，这是学好 `MySQL` 数据库的前提。

`MySQL` 由**连接池**、**SQL 接口**、**解析器**、**优化器**、**缓存**、**存储引擎**等组成，可以分为三层，即 **MySQL Server 层**、**存储引擎层和文件系统层**。**MySQL Server 层**又包括**连接层**和 **SQL 层**。如下是官方文档中 `MySQL` 的基础架构图：

![](https://cdn.jsdelivr.net/gh/shuxhan/pic-cdn@a272de622fbd517c1f5fc10f208b099c85befec3/2021/04/25/dd517eaa7e2b2dae174cbceff59d8ad4.png)

上图中，`Connection pool`  为**连接层**，`Management Services & Utilities ...Caches & Buffers` 为 **SQL 层**，`Pluggable Storage Engines` 为**存储引擎层**，`File system、Files & Logs` 为**文件系统层**。

`Connectors` 不属于以上任何一层，可以将 `Connectors` 理解为各种**客户端**、**应用服务**，主要指的是不同语言与 `SQL` 的**交互**。

#### 1. 连接层

- 应用程序通过**接口**（如 `ODBC`、`JDBC`）来连接 `MySQL`，最先连接处理的是**连接层**。**连接层**包括**通信协议**、**线程处理**、**用户名密码认证** 3 部分。
- **通信协议**负责检测客户端版本是否兼容 **MySQL 服务端**。
- **线程处理**是指每一个连接请求都会分配一个对应的线程，相当于一条 `SQL` 对应一个线程，一个线程对应一个**逻辑 CPU**，在多个**逻辑 CPU 之间**进行切换。
- **密码认证**用来验证用户创建的**账号**、**密码**，以及 **host 主机授权**是否可以连接到 **MySQL 服务器**。

`Connection Pool（连接池）`属于**连接层**。由于每次建立连接都需要消耗很多时间，连接池的作用就是将**用户连接**、**用户名**、**密码**、**权限校验**、**线程处理**等需要缓存的需求缓存下来，下次可以直接用已经建立好的连接，提升服务器性能。

#### 2. SQL层

- **SQL 层**是 `MySQL` 的核心，`MySQL` 的核心服务都是在这层实现的。主要包含**权限判断**、**查询缓存**、**解析器**、**预处理**、**查询优化器**、**缓存**和**执行计划**。
- **权限判断**可以审核用户有没有访问某个库、某个表，或者表里某行数据的权限。
- **查询缓存**通过 `Query Cache` 进行操作，如果数据在 `Query Cache` 中，则直接返回结果给客户端，不必再进行查询解析、优化和执行等过程。
- **查询解析器**针对 `SQL` 语句进行解析，判断语法是否正确。
- **预处理器**对**解析器**无法解析的语义进行处理。
- **查询优化器**对 `SQL` 进行改写和相应的优化，并生成最优的执行计划，就可以调用程序的 **API 接口**，通过**存储引擎层**访问数据。


`Management Services & Utilities`、`SQL Interface`、`Parser`、`Optimizer` 和 `Caches & Buffers` 属于 **SQL 层**，详细说明如下表所示。

| 名称 | 说明 |
| ---- | ---- |
| Management Services & Utilities | MySQL 的系统管理和控制工具，包括备份恢复、MySQL 复制、集群等。 |
| SQL Interface（SQL 接口） | 用来接收用户的 SQL 命令，返回用户需要查询的结果。例如 SELECT FROM 就是调用 SQL Interface。 |
| Parser（查询解析器） | 在 SQL 命令传递到解析器的时候会被解析器验证和解析，以便 MySQL 优化器可以识别的数据结构或返回 SQL 语句的错误。 |
| Optimizer（查询优化器） | SQL 语句在查询之前会使用查询优化器对查询进行优化，同时验证用户是否有权限进行查询，缓存中是否有可用的最新数据。它使用“选取-投影-连接”策略进行查询。例如 SELECT id, name FROM student WHERE gender = "女";语句中，SELECT 查询先根据 WHERE 语句进行选取，而不是将表全部查询出来以后再进行 gender 过滤。SELECT 查询先根据 id 和 name 进行属性投影，而不是将属性全部取出以后再进行过滤，将这两个查询条件连接起来生成最终查询结果。 |
| Caches & Buffers（查询缓存） | 如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的，比如表缓存、记录缓存、key 缓存、权限缓存等。 |
	
#### 3. 存储引擎层

`Pluggable Storage Engines` 属于**存储引擎层**。**存储引擎层**是 `MySQL` 数据库区别于其他数据库最核心的一点，也是 `MySQL` 最具特色的一个地方。主要负责 `MySQL` 中数据的存储和提取。

因为在关系数据库中，数据的存储是以表的形式存储的，所以存储引擎也可以称为**表类型（即存储和操作此表的类型）**。

#### 4. 文件系统层

**文件系统层**主要是将数据库的数据存储在操作系统的文件系统之上，并完成与存储引擎的交互。